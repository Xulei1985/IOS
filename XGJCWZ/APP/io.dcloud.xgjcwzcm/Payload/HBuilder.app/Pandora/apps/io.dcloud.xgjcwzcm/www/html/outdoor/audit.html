<!doctype html>
<html>

	<head>
		<meta charset="UTF-8">
		<title>加班详情</title>
		<meta name="viewport" content="width=device-width,initial-scale=1,minimum-scale=1,maximum-scale=1,user-scalable=no" />
		<link href="../../js/mui/css/mui.min.css" rel="stylesheet" />
		<link rel="stylesheet" href="../../style/weui.css" />
		<link rel="stylesheet" href="../../fonts/iconfont.css" />
		<link rel="stylesheet" href="../../style/style.css" />
		<script src="../../js/flexible.js"></script>
	</head>

	<body ontouchstart>
		<header class="pui-header">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="margin-top: 12px;"></a>
			<h1 class="pui-title" id="auditTitle"></h1>
		</header>
		<div class="ui-wrap">
			<div class="weui-cells weui-info-cells">
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">出门证编号</div>
					</div>
					<div class="weui-cell__ft" id="orderNo"></div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">持证人</div>
					</div>
					<div class="weui-cell__ft" id="holderName"></div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">持物部门</div>
					</div>
					<div class="weui-cell__ft" id="holderOrgId"></div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">物资类型</div>
					</div>
					<div class="weui-cell__ft" id="materialTypeCode"></div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">司机</div>
					</div>
					<div class="weui-cell__ft" id="driverName"></div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">证件类型</div>
					</div>
					<div class="weui-cell__ft" id="driverCardTypeName"></div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">证件号</div>
					</div>
					<div class="weui-cell__ft" id="driverCardId"></div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">车牌号</div>
					</div>
					<div class="weui-cell__ft" id="license"></div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">仓库</div>
					</div>
					<div class="weui-cell__ft" id="warehouseName"></div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">出厂原因</div>
					</div>
					<div class="weui-cell__ft" id="reason"></div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">申请人</div>
					</div>
					<div class="weui-cell__ft" id="applyUserName"></div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">申请时间</div>
					</div>
					<div class="weui-cell__ft" id="applyTime"></div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">备注</div>
					</div>
					<div class="weui-cell__ft" >
						<textarea class="weui-cell__ft" id="remark"></textarea>
					</div>
				</div>
			</div>
		</div>
		<div id="checkbutton">
			<div class="button-group">
				<button class="weui-btn weui-btn_default" onclick="agree()">同意</button>
				<button class="weui-btn weui-btn_danger" id="negation" onclick="negation()">不同意</button>
			</div>
		</div>
		<script type="text/javascript" src="../../js/plugins/jquery-2.1.1.min.js"></script>
		<script type="text/javascript" src="../../js/plugins/zepto.min.js"></script>
		<script type="text/javascript" src="../../js/mui/js/mui.js"></script>
		<script type="text/javascript" src="../../js/util.js"></script>
		<script type="text/javascript" src="../../js/plugins/template.js"></script>
		<script type="text/javascript" src="../../js/plugins/mainPage.js"></script>
		<script type="text/javascript" src="../../js/plugins/update.js"></script>
		<script src="../../js/mui/js/mui.min.js"></script>
		<script type="text/javascript">
			var arr = [];
			function agree() {
				var self = plus.webview.currentWebview();
				var tempType = self.status;
				var tempUrl;
				if(tempType === "待审核"){
					tempUrl = "/outdoor/"+self.outdoorId+"/audit";
				}else if(tempType === "待审批"){
					tempUrl = "/outdoor/"+self.outdoorId+"/approve";
				}
				var datas = new Object();
				datas.id = self.outdoorId;
				datas.orderNo = self.orderNo;
				datas.holderName = self.holderName;
				datas.holderOrgId = self.holderOrgId;
				datas.materialTypeCode = self.materialTypeCode;
				datas.driverName = self.driverName;
				datas.driverCardTypeCode = self.driverCardTypeCode;
				datas.driverCardId = self.driverCardId;
				datas.license = self.license;
				datas.warehouseCode = self.warehouseCode;
				datas.reason = self.reason;
				if(self.status === "待审核"){
					datas.auditStatus = true;
					datas.auditRemark = $("#remark").val()
				}else{
					datas.approveStatus = true;
					datas.approveRemark = $("#remark").val()
				}
				util.ajax({
					type: 'put',
					url: tempUrl,
					dataType: 'json',
					data: datas,
					contentType: "application/json",
					success: function(data) {
						mui.toast("操作成功");
						Page.backInit();
					},
					error: function(xhr, type, errorThrown) {
						var temp = JSON.parse(xhr.response)
						mui.toast(temp.message);
						
					}
				});
			}
			
			function negation() {
				var self = plus.webview.currentWebview();
				var tempType = self.status;
				var tempUrl;
				if(tempType === "待审核"){
					tempUrl = "/outdoor/"+self.outdoorId+"/audit";
				}else if(tempType === "待审批"){
					tempUrl = "/outdoor/"+self.outdoorId+"/approve";
				}
				var datas = new Object();
				datas.id = self.outdoorId;
				var temp = $("#remark").val();
				if(temp == null || temp == undefined || temp == ''){
					mui.toast("请在备注内填写拒绝原因！");
					return false;
				}
				if(self.status === "待审核"){
					datas.auditStatus = false;
					datas.auditRemark = $("#remark").val()
				}else{
					datas.approveStatus = false;
					datas.approveRemark = $("#remark").val()
				}
				util.ajax({
					type: 'put',
					url: tempUrl,
					dataType: 'json',
					data: datas,
					contentType: "application/json",
					success: function(data) {
						mui.toast("操作成功");
						Page.backInit();
					},
					error: function(xhr, type, errorThrown) {
						console.log("xhr:"+xhr)
						console.log("type:"+type)
						console.log("errorThrown:"+errorThrown)
					}
				});
			}
			
			
			var Page = {
				init: function() {
					var self = plus.webview.currentWebview();
					var a = 0;
					var tempType = self.status;
					var tempTitle;
					if(tempType === "待审核"){
						tempTitle = "审核详情"
					}else if(tempType === "待审批"){
						tempTitle = "审批详情"
					}
					$("#auditTitle").html(tempTitle)
					$("#orderNo").html(self.orderNo);
					$("#holderName").html(self.holderName);
					$("#holderOrgId").html(self.holderOrgId);
					$("#materialTypeCode").html(self.materialTypeCode);
					$("#driverName").html(self.driverName);
					$("#driverCardTypeCode").html(self.driverCardTypeCode);
					$("#driverCardId").html(self.driverCardId);
					$("#license").html(self.license);
					$("#warehouseCode").html(self.warehouseCode);
					$("#reason").html(self.reason);
				},
				backInit: function() {
					var wvB = plus.webview.currentWebview(); //获取当前窗口的WebviewObject对象，即B  
					var wvA = wvB.opener(); //获取当前窗口的创建者，即A  
					wvA.evalJS("Page.backInit()"); //执行父窗口中的方法  A中的showAG方法  
					wvB.close();
				},
			};
			mui.plusReady(function() {
				Page.init();
				util.appBack();
			});
		</script>
	</body>

</html>
