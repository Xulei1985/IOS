<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<link href="../../js/mui/css/mui.css" type="text/css" rel="stylesheet" />
		<link rel="stylesheet" href="../../style/weui.css" />
		<link rel="stylesheet" href="../../fonts/iconfont.css" />
		<link rel="stylesheet" href="../../style/style.css" />
		<script src="../../js/flexible.js"></script>
		<script src="../../js/jquery.min.js"></script>
		<script src="../../js/common.js"></script>
	</head>
	<body ontouchstart>
		<header class="pui-header">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="margin-top: 12px;"></a>
			<h1 class="pui-title">物资明细</h1>
		</header>
		<div class="ui-wrap">
			<div id="refreshContainer" hidden="hidden"></div>
			<div id="domContainer">
			</div>
		</div>
		<script type="text/javascript" src="../../js/plugins/jquery-2.1.1.min.js"></script>
		<script type="text/html" id="template">
			<%for(var i=0;i<data.length;i++){%>
			<a href="javascript:;" class="weui-cell weui-cell_access">
				<div class="weui-cell__bd">
				<span class="qk-status <%=data[i].statusClass%>"><%=data[i].warehouseStatus%></span>
					<span class="card-info">条码:<%=data[i].barcode%></span>
					<div class="time-div">物料编码：<%=data[i].materialCode%></div>
					<div class="time-div">物料名称：<%=data[i].materialName%></div>
					<div class="time-div">物料单位：<%=data[i].materialUnit%></div>
					<div class="time-div">物料数量：<%=data[i].materialCount%></div>
					<div class="time-div">仓库：<%=data[i].warehouseName%></div>
					<div class="time-div">库位：<%=data[i].warehouseLocationName%></div>
					<div class="time-div">入库时间：<%=data[i].warehouseTime%></div>		
				</div>
			</a>
			<%}%>
		</script>

		<script type="text/javascript" src="../../js/mui/js/mui.js"></script>
		<script type="text/javascript" src="../../js/plugins/zepto.min.js"></script>
		<script type="text/javascript" src="../../js/plugins/template.js"></script>
		<script type="text/javascript" src="../../js/util.js"></script>
		<script type="text/javascript" src="../../js/codescan/jquery.code-scan.js"></script>

		<script type="text/javascript">
			var statusClass=["status-red","status-end"];
			var Page = {
				init: function() {
					var current = plus.webview.currentWebview();
					util.pullRefresh({
						source: '/barcode/query',
						container: "#refreshContainer",
						domContainer:'#domContainer',
						type: "POST",
						params: {
							criteria:{
								warehouseCode:current.warehouseCode,
								warehouseLocationCode:current.warehouseLocationCode,
								materialCode:current.materialCode
							}
						},
						resultHandler: function(data) {
							$.each(data.data,function(){
								this.statusClass = statusClass[this.warehouseStatusValue||0]
							});
							return data;
						},
						down: true,
						up: true,
						template: 'template'
					})
				},
				// 重新加载时使用
				// 重新加载时使用
				reload: function() {
					this.backInit();
				},
				backInit: function() {
					util.pullRefreshRequest("down");
				},
				back: function() {
					var wvB = plus.webview.currentWebview(); //获取当前窗口的WebviewObject对象，即B  
					var wvA = wvB.opener(); //获取当前窗口的创建者，即A  
					wvA.evalJS("Page.reload()"); //执行父窗口中的方法  A中的showAG方法  
					wvB.close();
				},
				beforeback: function() {
					var list = plus.webview.currentWebview().opener();
					//refresh是A页面自定义事件
					mui.fire(list, 'refresh');
					//返回true,继续页面关闭逻辑
					return true;
				}
			}


			mui.plusReady(function() {
				Page.init();
			});
		</script>
	</body>

</html>
