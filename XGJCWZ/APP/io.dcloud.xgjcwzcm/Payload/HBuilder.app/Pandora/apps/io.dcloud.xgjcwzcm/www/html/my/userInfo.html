<!DOCTYPE html>
<html>
	<head>
		<meta charset="UTF-8">
		<title></title>
		<meta name="viewport" content="width=device-width, initial-scale=1,maximum-scale=1,user-scalable=no">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<!--标准mui.css-->
		<link href="../../js/mui/css/mui.css" type="text/css" rel="stylesheet" />
				<link rel="stylesheet" href="../../style/weui.css" />
		<link rel="stylesheet" href="../../fonts/iconfont.css" />
		<link rel="stylesheet" href="../../style/style.css" />
		<script src="../../js/flexible.js"></script>
	</head>
	<body ontouchstart>
		<header class="pui-header">
			<a class="mui-action-back mui-icon mui-icon-left-nav mui-pull-left" style="margin-top: 12px;"></a>
			<h1 class="pui-title">基础消息</h1>
		</header>
		<div class="ui-wrap">
			<div class="info-logo">
				<img src="../../images/inlogo.png" alt="" />
			</div>
			<div class="weui-cells weui-info-cells">
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">登录账号</div>
					</div>
					<div class="weui-cell__ft" id="username"></div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">姓名</div>
					</div>
					<div class="weui-cell__ft" id="name"></div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">部门</div>
					</div>
					<div class="weui-cell__ft" id="deptName"></div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">电话</div>
					</div>
					<div class="weui-cell__ft" id="phone"></div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">仓库</div>
					</div>
					<div class="weui-cell__ft" >
						<select id="warehouse">
							
						</select>
					</div>
				</div>
				<div class="weui-cell">
					<div class="weui-cell__bd">
						<div class="label-text">库位</div>
					</div>
					<div class="weui-cell__ft">
						<select id="warehouseLocation">
							
						</select>
					</div>
				</div>
			</div>
		</div>
		<script type="text/javascript" src="../../js/plugins/jquery-2.1.1.min.js"></script>
		<script type="text/javascript" src="../../js/mui/js/mui.js"></script>
		<script type="text/javascript" src="../../js/util.js"></script>
		<script type="text/javascript" src="../../js/control.js"></script>
		<script type="text/javascript" src="../../js/plugins/update.js"></script>
		<script type="text/javascript">
			var Page = {
				warehouseData:null,
				warehouseLocationData:null,
				init: function() {
					this.initEvent();
					this.getUserInfo();
					this.getWarehouse();
				},
				getUserInfo: function() {
					util.ajax({
						type: 'get',
						url: '/member/info',
						success:function(data) { 
							$("#username").html(data.loginName)
							$("#name").html(data.name)
							$("#deptName").html(data.org)
							$("#phone").html(data.mobile)
						}
					});
				},
				getWarehouse:function(){
					var that  = this;
					util.ajax({
						url:'/warehouse/list',
						success:function(data){
							var html=['<option>选择仓库</option>'];
							that.warehouseData = data;
							$.each(data,function(){
								html.push('<option value="'+this.code+'">'+this.code+"-"+this.name+'</option>');
							})
							$("#warehouse").html(html.join(""));
							var cache = control.getWarehouseCache();
							if(cache){
								$("#warehouse").val(cache.code).trigger("change");
							}
						}
					})
				},
				getWarehouseLocation:function(code){
					var that = this;
					util.ajax({
						url:"/warehouseLocation/"+code+"/list",
						success:function(data){
							that.warehouseLocationData = data;
							var html=['<option>选择库位</option>'];
							$.each(data,function(){
								html.push('<option value="'+this.code+'">'+this.code+"-"+this.name+'</option>');
							})
							$("#warehouseLocation").html(html.join(""));
							var cache = control.getWarehouseLocationCache();
							if(cache){
								$("#warehouseLocation").val(cache.code);
							}
						}
					});
				},
				initEvent:function(){
					var that = this;
					$("#warehouse").on("change",function(){
						var code = $(this).val();
						var warehouseData = null;
						$.each(that.warehouseData,function(){
							if(this.code == code){
								warehouseData = this;
								return false;
							}
						})
						control.setWarehouse(warehouseData);
						that.getWarehouseLocation(code);
					});
					$("#warehouseLocation").on("change",function(){
						var code = $(this).val();
						var warehouseLocationData = null;
						$.each(that.warehouseLocationData,function(){
							if(this.code == code){
								warehouseLocationData = this;
								return false;
							}
						})
						control.setWarehouseLocation(warehouseLocationData);
					});
				}
			}
			mui.plusReady(function() {
				Page.init();
			});
		</script>
	</body>
</html>
